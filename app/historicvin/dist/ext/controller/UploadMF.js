sap.ui.define(["sap/m/MessageToast"],function(e){"use strict";function o(o){var t;function n(e){t&&t.getBeginButton().setEnabled(e)}function r(e){t.setBusy(e)}function s(){t&&t.close()}function a(e){MessageBox.error(e||"Upload failed")}function i(e){return sap.ui.core.Fragment.byId("uploadDialog",e)}return{onBeforeOpen:function(e){t=e.getSource();o.addDependent(t)},onAfterClose:function(e){o.removeDependent(t);t.destroy();t=undefined},onFileChange:function(o){const t=o.getParameter("files")?.[0];if(!t)return;const n=new FileReader;n.onload=o=>{this._csvText=o.target.result;e.show("CSV loaded. Click Process.")};n.onerror=()=>e.show("Failed to read file.");n.readAsText(t)},onOk:function(o){if(!this._csvText){return e.show("Please select a CSV file first.")}fetch("/odata/v4/vinlog/uploadMiGTemp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:this._csvText})}).then(async e=>{if(!e.ok)throw new Error(await e.text());return e.json()}).then(o=>{const t=o?.value??o;if(t){e.show(t)}else{e.show("Processing complete.")}s()}).catch(o=>{let t="Unknown error";try{const e=JSON.parse(o.message.replace(/^Error:\s*/,""));t=e?.error?.message||t}catch(e){t=o.message}console.log(t);e.show(t);s()})},onCancel:function(e){s()},onTypeMismatch:function(e){var o=e.getSource().getFileType().map(function(e){return"*."+e}).join(", ");a("The file type *."+e.getParameter("fileType")+" is not supported. Choose one of the following types: "+o)},onFileAllowed:function(e){n(true)},onFileEmpty:function(e){n(false)},onUploadComplete:function(t){var i=t.getParameter("status");var l=t.getSource();l.clear();n(false);r(false);if(i>=400){var c=JSON.parse(t.getParameter("responseRaw"));a(c&&c.error&&c.error.message)}else{e.show("Uploaded successfully");o.refresh();s()}}}}return{UploadMigM:function(t,n){var r=o(this);this.loadFragment({id:"uploadDialog",name:"historicvin.ext.fragment.UploadDialog",controller:r}).then(function(e){e.open()});e.show("Custom handler invoked.")}}});
//# sourceMappingURL=UploadMF.js.map