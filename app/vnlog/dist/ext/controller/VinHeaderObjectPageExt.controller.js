sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast"],function(e,t,n){"use strict";console.log("VinHeaderObjectPageExt loaded");function o(e){var o;function r(e){o&&o.getBeginButton().setEnabled(e)}function s(e){o.setBusy(e)}function a(){o&&o.close()}function i(e){n.error(e||"Upload failed")}function c(e){return sap.ui.core.Fragment.byId("uploadDialog",e)}return{onBeforeOpen:function(t){o=t.getSource();e.addDependent(o)},onAfterClose:function(t){e.removeDependent(o);o.destroy();o=undefined},onFileChange:function(e){const n=e.getParameter("files")?.[0];if(!n)return;const o=new FileReader;o.onload=e=>{this._csvText=e.target.result;t.show("CSV loaded. Click Process.")};o.onerror=()=>t.show("Failed to read file.");o.readAsText(n)},onOk:function(e){if(!this._csvText){return t.show("Please select a CSV file first.")}fetch("/odata/v4/vinlog/uploadCSV",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({opportunityID:this._vinKey,content:this._csvText})}).then(async e=>{if(!e.ok)throw new Error(await e.text());return e.json()}).then(e=>{const n=e?.value??e;t.show("Processing complete.");a()}).catch(e=>{console.error(e);t.show("Error processing CSV.")})},onCancel:function(e){a()},onTypeMismatch:function(e){var t=e.getSource().getFileType().map(function(e){return"*."+e}).join(", ");i("The file type *."+e.getParameter("fileType")+" is not supported. Choose one of the following types: "+t)},onFileAllowed:function(e){r(true)},onFileEmpty:function(e){r(false)},onUploadComplete:function(n){var o=n.getParameter("status");var c=n.getSource();c.clear();r(false);s(false);if(o>=400){var l=JSON.parse(n.getParameter("responseRaw"));i(l&&l.error&&l.error.message)}else{t.show("Uploaded successfully");e.refresh();a()}}}}return e.extend("vnlog.ext.controller.VinHeaderObjectPageExt",{onInit:function(){console.log("init method trigered");var e=this.getOwnerComponent().getRouter();e.getRoute("vinHeaderSrvObjectPage").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){console.log("Route arguments:",e.getParameter("arguments"));var t=e.getParameter("arguments");var n=t.contextPath;if(n){var o=/'([^']+)'/.exec(n);if(o){this._vinKey=o[1];sap.m.MessageToast.show("VIN Key: "+this._vinKey);console.log("Matched VIN Key:",this._vinKey);return}}if(t.key){this._vinKey=t.key;sap.m.MessageToast.show("VIN Key: "+this._vinKey);console.log("Matched VIN Key:",this._vinKey)}},onAfterAction:function(e){var t=this.byId("vinFailureSrvObjectPage");var n=t.getBinding("items");if(n){n.refresh()}}})});
//# sourceMappingURL=VinHeaderObjectPageExt.controller.js.map