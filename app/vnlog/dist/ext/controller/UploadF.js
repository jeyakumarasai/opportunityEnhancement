sap.ui.define(["sap/m/MessageToast","sap/m/MessageBox","sap/ui/unified/FileUploader"],function(e,o){"use strict";function t(t){var n;function r(e){n&&n.getBeginButton().setEnabled(e)}function s(e){n.setBusy(e)}function a(){n&&n.close()}function i(e){o.error(e||"Upload failed")}function l(e){return sap.ui.core.Fragment.byId("uploadDialog",e)}return{onBeforeOpen:function(e){n=e.getSource();t.addDependent(n)},onAfterClose:function(e){t.removeDependent(n);n.destroy();n=undefined},onFileChange:function(o){const t=o.getParameter("files")?.[0];if(!t)return;const n=new FileReader;n.onload=o=>{this._csvText=o.target.result;e.show("CSV loaded. Click Process.")};n.onerror=()=>e.show("Failed to read file.");n.readAsText(t)},onOk:function(o){if(!this._csvText){return e.show("Please select a CSV file first.")}fetch("/odata/v4/vinlog/uploadCSV",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({opportunityID:this._vinKey,content:this._csvText})}).then(async e=>{if(!e.ok)throw new Error(await e.text());return e.json()}).then(o=>{const t=o?.value??o;if(t){e.show(t)}else{e.show("Processing complete.")}a()}).catch(o=>{let t="Unknown error";try{const e=JSON.parse(o.message.replace(/^Error:\s*/,""));t=e?.error?.message||t}catch(e){t=o.message}console.log(t);e.show(t);a()})},onCancel:function(e){a()},onTypeMismatch:function(e){var o=e.getSource().getFileType().map(function(e){return"*."+e}).join(", ");i("The file type *."+e.getParameter("fileType")+" is not supported. Choose one of the following types: "+o)},onFileAllowed:function(e){r(true)},onFileEmpty:function(e){r(false)},onUploadComplete:function(o){var n=o.getParameter("status");var l=o.getSource();l.clear();r(false);s(false);if(n>=400){var c=JSON.parse(o.getParameter("responseRaw"));i(c&&c.error&&c.error.message)}else{e.show("Uploaded successfully");t.refresh();a()}}}}return{UploadM:function(o,n){var r=t(this);const s=o||this.getBindingContext();const a=s.getProperty("opportunityID");r._vinKey=a;this.loadFragment({id:"uploadDialog",name:"vnlog.ext.fragment.UploadDialog",controller:r}).then(function(e){e.open()});e.show("Custom handler invoked.")}}});
//# sourceMappingURL=UploadF.js.map