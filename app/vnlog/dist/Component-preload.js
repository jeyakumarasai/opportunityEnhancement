//@ui5-bundle vnlog/Component-preload.js
sap.ui.predefine("vnlog/Component", ["sap/fe/core/AppComponent"],function(e){"use strict";return e.extend("vnlog.Component",{metadata:{manifest:"json"}})});
sap.ui.predefine("vnlog/ext/controller/UploadF", ["sap/m/MessageToast","sap/m/MessageBox","sap/ui/unified/FileUploader"],function(e,o){"use strict";function t(t){var n;function r(e){n&&n.getBeginButton().setEnabled(e)}function s(e){n.setBusy(e)}function a(){n&&n.close()}function i(e){o.error(e||"Upload failed")}function l(e){return sap.ui.core.Fragment.byId("uploadDialog",e)}return{onBeforeOpen:function(e){n=e.getSource();t.addDependent(n)},onAfterClose:function(e){t.removeDependent(n);n.destroy();n=undefined},onFileChange:function(o){const t=o.getParameter("files")?.[0];if(!t)return;const n=new FileReader;n.onload=o=>{this._csvText=o.target.result;e.show("CSV loaded. Click Process.")};n.onerror=()=>e.show("Failed to read file.");n.readAsText(t)},onOk:function(o){if(!this._csvText){return e.show("Please select a CSV file first.")}fetch("/odata/v4/vinlog/uploadCSV",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({opportunityID:this._vinKey,content:this._csvText})}).then(async e=>{if(!e.ok)throw new Error(await e.text());return e.json()}).then(o=>{const t=o?.value??o;if(t){e.show(t)}else{e.show("Processing complete.")}a()}).catch(o=>{let t="Unknown error";try{const e=JSON.parse(o.message.replace(/^Error:\s*/,""));t=e?.error?.message||t}catch(e){t=o.message}console.log(t);e.show(t);a()})},onCancel:function(e){a()},onTypeMismatch:function(e){var o=e.getSource().getFileType().map(function(e){return"*."+e}).join(", ");i("The file type *."+e.getParameter("fileType")+" is not supported. Choose one of the following types: "+o)},onFileAllowed:function(e){r(true)},onFileEmpty:function(e){r(false)},onUploadComplete:function(o){var n=o.getParameter("status");var l=o.getSource();l.clear();r(false);s(false);if(n>=400){var c=JSON.parse(o.getParameter("responseRaw"));i(c&&c.error&&c.error.message)}else{e.show("Uploaded successfully");t.refresh();a()}}}}return{UploadM:function(o,n){var r=t(this);const s=o||this.getBindingContext();const a=s.getProperty("opportunityID");r._vinKey=a;this.loadFragment({id:"uploadDialog",name:"vnlog.ext.fragment.UploadDialog",controller:r}).then(function(e){e.open()});e.show("Custom handler invoked.")}}});
sap.ui.predefine("vnlog/ext/controller/VinHeaderObjectPageExt.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageToast"],function(e,t,n){"use strict";console.log("VinHeaderObjectPageExt loaded");function o(e){var o;function r(e){o&&o.getBeginButton().setEnabled(e)}function s(e){o.setBusy(e)}function a(){o&&o.close()}function i(e){n.error(e||"Upload failed")}function c(e){return sap.ui.core.Fragment.byId("uploadDialog",e)}return{onBeforeOpen:function(t){o=t.getSource();e.addDependent(o)},onAfterClose:function(t){e.removeDependent(o);o.destroy();o=undefined},onFileChange:function(e){const n=e.getParameter("files")?.[0];if(!n)return;const o=new FileReader;o.onload=e=>{this._csvText=e.target.result;t.show("CSV loaded. Click Process.")};o.onerror=()=>t.show("Failed to read file.");o.readAsText(n)},onOk:function(e){if(!this._csvText){return t.show("Please select a CSV file first.")}fetch("/odata/v4/vinlog/uploadCSV",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({opportunityID:this._vinKey,content:this._csvText})}).then(async e=>{if(!e.ok)throw new Error(await e.text());return e.json()}).then(e=>{const n=e?.value??e;t.show("Processing complete.");a()}).catch(e=>{console.error(e);t.show("Error processing CSV.")})},onCancel:function(e){a()},onTypeMismatch:function(e){var t=e.getSource().getFileType().map(function(e){return"*."+e}).join(", ");i("The file type *."+e.getParameter("fileType")+" is not supported. Choose one of the following types: "+t)},onFileAllowed:function(e){r(true)},onFileEmpty:function(e){r(false)},onUploadComplete:function(n){var o=n.getParameter("status");var c=n.getSource();c.clear();r(false);s(false);if(o>=400){var l=JSON.parse(n.getParameter("responseRaw"));i(l&&l.error&&l.error.message)}else{t.show("Uploaded successfully");e.refresh();a()}}}}return e.extend("vnlog.ext.controller.VinHeaderObjectPageExt",{onInit:function(){console.log("init method trigered");var e=this.getOwnerComponent().getRouter();e.getRoute("vinHeaderSrvObjectPage").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){console.log("Route arguments:",e.getParameter("arguments"));var t=e.getParameter("arguments");var n=t.contextPath;if(n){var o=/'([^']+)'/.exec(n);if(o){this._vinKey=o[1];sap.m.MessageToast.show("VIN Key: "+this._vinKey);console.log("Matched VIN Key:",this._vinKey);return}}if(t.key){this._vinKey=t.key;sap.m.MessageToast.show("VIN Key: "+this._vinKey);console.log("Matched VIN Key:",this._vinKey)}},onAfterAction:function(e){var t=this.byId("vinFailureSrvObjectPage");var n=t.getBinding("items");if(n){n.refresh()}}})});
sap.ui.require.preload({
	"vnlog/ext/fragment/UploadDialog.fragment.xml":'<core:FragmentDefinition xmlns:core="sap.ui.core" xmlns:u="sap.ui.unified"\n                         xmlns="sap.m"><Dialog id="uploadDialog" title="Import Vin Data" class="sapUiResponsiveContentPadding" beforeOpen=".onBeforeOpen"\n            afterClose=".onAfterClose"><content><u:FileUploader\n                    id="uploader"\n                    name="csv"\n                    multiple="false"\n                    fileAllowed=".onFileAllowed"\n                    fileEmpty=".onFileEmpty"\n                    uploadComplete=".onUploadComplete"\n                    typeMissmatch=".onTypeMismatch"\n                    change=".onFileChange"\n                    sendXHR="true"\n                    useMultipart="false"\n                    placeholder="Choose a CSV file..."\n                    httpRequestMethod="Post"/></content><beginButton><Button id="ok" text="OK" press=".onOk" type="Emphasized" enabled="false"/></beginButton><endButton><Button id="cancel" text="Cancel" press=".onCancel"/></endButton></Dialog></core:FragmentDefinition>',
	"vnlog/i18n/i18n.properties":'# This is the resource bundle for vnlog\n\n#Texts for manifest.json\n\n#XTIT: Application name\nappTitle=Vin Log\n\n#YDES: Application description\nappDescription=An SAP Fiori application.\n\n#XFLD,35\nvinlog-managed.flpTitle=Vin Log\n',
	"vnlog/manifest.json":'{"_version":"1.76.0","sap.app":{"id":"vnlog","type":"application","i18n":{"bundleUrl":"i18n/i18n.properties","supportedLocales":[""]},"applicationVersion":{"version":"0.0.1"},"title":"{{appTitle}}","description":"{{appDescription}}","resources":"resources.json","sourceTemplate":{"id":"@sap/generator-fiori:lrop","version":"1.20.0","toolsId":"5d0cf565-2f20-4caa-ba28-0b397ae92e87"},"dataSources":{"mainService":{"uri":"/odata/v4/vinlog/","type":"OData","settings":{"annotations":[],"odataVersion":"4.0"}}},"crossNavigation":{"inbounds":{"vinlog-managed":{"semanticObject":"vinlog","action":"managed","title":"{{vinlog-managed.flpTitle}}","signature":{"parameters":{},"additionalParameters":"allowed"}}}}},"sap.ui":{"technology":"UI5","icons":{"icon":"","favIcon":"","phone":"","phone@2":"","tablet":"","tablet@2":""},"deviceTypes":{"desktop":true,"tablet":true,"phone":true}},"sap.ui5":{"flexEnabled":true,"dependencies":{"minUI5Version":"1.143.2","libs":{"sap.m":{},"sap.ui.core":{},"sap.fe.templates":{}}},"contentDensities":{"compact":true,"cozy":true},"models":{"i18n":{"type":"sap.ui.model.resource.ResourceModel","settings":{"bundleName":"vnlog.i18n.i18n","supportedLocales":[""]}},"":{"dataSource":"mainService","preload":true,"settings":{"operationMode":"Server","autoExpandSelect":true,"earlyRequests":true}},"@i18n":{"type":"sap.ui.model.resource.ResourceModel","uri":"i18n/i18n.properties","settings":{"supportedLocales":[""]}}},"resources":{"css":[]},"extends":{"extensions":{"sap.ui.controllerExtensions":{"vnlog::vinHeaderSrvObjectPage":{"controller":"vnlog.ext.controller.VinHeaderObjectPageExt"}}}},"routing":{"config":{},"routes":[{"pattern":":?query:","name":"vinHeaderSrvList","target":"vinHeaderSrvList"},{"pattern":"vinHeaderSrv({key}):?query:","name":"vinHeaderSrvObjectPage","target":"vinHeaderSrvObjectPage"},{"pattern":"vinHeaderSrv({key})/items_success({key2}):?query:","name":"vinSuccessSrvObjectPage","target":"vinSuccessSrvObjectPage"}],"targets":{"vinHeaderSrvList":{"type":"Component","id":"vinHeaderSrvList","name":"sap.fe.templates.ListReport","options":{"settings":{"contextPath":"/vinHeaderSrv","variantManagement":"Page","navigation":{"vinHeaderSrv":{"detail":{"route":"vinHeaderSrvObjectPage"}}},"controlConfiguration":{"@com.sap.vocabularies.UI.v1.LineItem":{"tableSettings":{"type":"ResponsiveTable"}}}}}},"vinHeaderSrvObjectPage":{"type":"Component","id":"vinHeaderSrvObjectPage","name":"sap.fe.templates.ObjectPage","options":{"settings":{"editableHeaderContent":false,"contextPath":"/vinHeaderSrv","navigation":{"items_success":{"detail":{"route":"vinSuccessSrvObjectPage"}}},"content":{"header":{"actions":{"upload":{"press":"vnlog.ext.controller.UploadF.UploadM","visible":true,"enabled":true,"text":"Upload","position":{"placement":"Before","anchor":"DeleteAction"}}}}}}}},"vinSuccessSrvObjectPage":{"type":"Component","id":"vinSuccessSrvObjectPage","name":"sap.fe.templates.ObjectPage","options":{"settings":{"editableHeaderContent":false,"contextPath":"/vinHeaderSrv/items_success"}}},"vinFailureSrvObjectPage":{"type":"Component","id":"vinFailureSrvObjectPage","name":"sap.fe.templates.ObjectPage","options":{"settings":{"editableHeaderContent":false,"contextPath":"/vinHeaderSrv/items_failure"}}}}},"flexBundle":false},"sap.fiori":{"registrationIds":[],"archeType":"transactional"},"sap.cloud":{"public":true,"service":"vinlog.service"}}'
});
//# sourceMappingURL=Component-preload.js.map
